# Fourier series

In Part III, Computing with Functions, we work with approximating functions by expansions in
bases: that is, instead of approximating at a grid (as in the Differential Equations chapter),
we approximate functions by other, simpler, functions. The most fundamental basis is (complex) Fourier
series:
$$
f(Î¸) = âˆ‘_{k = -âˆ}^âˆ fÌ‚â‚– {\rm e}^{{\rm i} k Î¸}
$$
where
$$
fÌ‚â‚– := {1 \over 2Ï€} âˆ«_0^{2Ï€} f(Î¸) {\rm e}^{-{\rm i} k Î¸} {\rm d}Î¸
$$
In numerical analysis we try to build on the analogy with linear algebra as much as possible.
Therefore we write this as:
$$
f(Î¸) = \underbrace{[â‹¯ | {\rm e}^{-2{\rm i}Î¸} |{\rm e}^{-{\rm i}Î¸} | \underline 1 | {\rm e}^{{\rm i}Î¸} | {\rm e}^{2{\rm i}Î¸} | â‹¯]}_{F(Î¸)}
\underbrace{\begin{bmatrix} â‹® \\ fÌ‚_{-2} \\ fÌ‚_{-1} \\ \underline{fÌ‚_0} \\ fÌ‚_1 \\ fÌ‚_2 \\ â‹® \end{bmatrix}}_ğŸÌ‚
$$
where the underline indicates the zero-index location.

More precisely, we are going to build an approximation using $n$ approximate coefficients $fÌ‚_k^n â‰ˆ fÌ‚_k$.
We separate this into three cases:
1. Odd: If $n = 2m+1$ we approximate
$$
\begin{align*}
f(Î¸) &â‰ˆ âˆ‘_{k = -m}^{m} fÌ‚â‚–^n {\rm e}^{{\rm i} k Î¸} \\
    &= \underbrace{[ {\rm e}^{-{\rm i}mÎ¸} | â‹¯ | {\rm e}^{-2{\rm i}Î¸} |{\rm e}^{-{\rm i}Î¸} | 1 | {\rm e}^{{\rm i}Î¸} | {\rm e}^{2{\rm i}Î¸} | â‹¯ |  {\rm e}^{{\rm i} m Î¸}]}_{F_{-m:m}(Î¸)} \begin{bmatrix} fÌ‚_{-m}^n \\ â‹® \\ fÌ‚_m^n \end{bmatrix}
\end{align*}
$$
2. Even: If $n = 2m$ we approximate
$$
\begin{align*}
f(Î¸) &â‰ˆ âˆ‘_{k = -m}^{m-1} fÌ‚â‚–^n {\rm e}^{{\rm i} k Î¸} \\
    &= \underbrace{[ {\rm e}^{-{\rm i}mÎ¸} | â‹¯ | {\rm e}^{-2{\rm i}Î¸} |{\rm e}^{-{\rm i}Î¸} | 1 | {\rm e}^{{\rm i}Î¸} | {\rm e}^{2{\rm i}Î¸} | â‹¯ |  {\rm e}^{{\rm i} (m-1) Î¸}]}_{F_{-m:m-1}(Î¸)} \begin{bmatrix} fÌ‚_{-m}^n \\ â‹® \\ fÌ‚_{m-1}^n \end{bmatrix}
\end{align*}
$$
3. Taylor: if we know the negative coefficients vanish ($0 = fÌ‚_{-1} = fÌ‚_{-2} = â‹¯$) we approximate
$$
\begin{align*}
f(Î¸) &â‰ˆ âˆ‘_{k = 0}^{n-1} fÌ‚â‚–^n {\rm e}^{{\rm i} k Î¸} \\
    &= \underbrace{[ 1 | {\rm e}^{{\rm i}Î¸} | {\rm e}^{2{\rm i}Î¸} | â‹¯ |  {\rm e}^{{\rm i} (n-1) Î¸}]}_{F_{0:n-1}(Î¸)} \begin{bmatrix} fÌ‚_0^n \\ â‹® \\ fÌ‚_{n-1}^n \end{bmatrix}
\end{align*}
$$
This can be thought of as an approximate Taylor expansion using the change-of-variables $z = {\rm e}^{{\rm i}Î¸}$.

## 1. Basics of Fourier series



In analysis one typically works with continuous functions and relates results to continuity.
In numerical analysis we inheritely have to work with _vectors_, so it is more natural
to  focus on the case where the _Fourier coefficients_ $fÌ‚_k$ are _absolutely convergent_,
or in otherwords, the $1$-norm of $ğŸÌ‚$ is bounded:
$$
\|ğŸÌ‚\|_1 = âˆ‘_{k=-âˆ}^âˆ |fÌ‚_k| < âˆ
$$

We first state a basic results (whose proof is beyond the scope of this module):


**Theorem (convergence)**
If the Fourier coeffients are absolutely convergent then
$$
f(Î¸) = âˆ‘_{k = -âˆ}^âˆ fÌ‚â‚– {\rm e}^{{\rm i} k Î¸},
$$
which converges uniformly.

**Remark (advanced)** We also have convergence for the continuous version
of the $2$-norm,
$$
\| f \|_2 := \sqrt{\int_0^{2Ï€} |f(Î¸)|^2 {\rm d} Î¸},
$$
for any function such that $\| f \|_2 < âˆ$, but we won't need that in
what follows.


Fortunately, continuity gives us sufficient (though not necessary) conditions for absolute convergence:

**Proposition (differentiability and absolutely convergence)** If $f : â„ â†’ â„‚$ and $f'$ are periodic
 and $f''$ is uniformly bounded, then its Fourier coefficients satisfy
$$
\|ğŸÌ‚\|â‚ < âˆ
$$

**Proof**
Integrate by parts twice using the fact that $f(0) = f(2Ï€)$, $f'(0) = f(2Ï€)$:
$$
\begin{align*}
fÌ‚â‚– &= âˆ«_0^{2Ï€} f(Î¸) {\rm e}^{-{\rm i} k Î¸} {\rm d}Î¸ =
[f(Î¸) {\rm e}^{-{\rm i} k Î¸}]_0^{2Ï€} + {1 \over {\rm i} k} âˆ«_0^{2Ï€} f'(Î¸) {\rm e}^{-{\rm i} k Î¸} {\rm d}Î¸ \\
&= {1 \over {\rm i} k} [f'(Î¸) {\rm e}^{-{\rm i} k Î¸}]_0^{2Ï€} - {1 \over k^2} âˆ«_0^{2Ï€} f''(Î¸) {\rm e}^{-{\rm i} k Î¸} {\rm d}Î¸ \\
&= - {1 \over k^2} âˆ«_0^{2Ï€} f''(Î¸) {\rm e}^{-{\rm i} k Î¸} {\rm d}Î¸
\end{align*}
$$
thus uniform boundedness of $f''$ guarantees $|fÌ‚â‚–| â‰¤Â M |k|^{-2}$ for some $M$, and we have
$$
âˆ‘_{k = -âˆ}^âˆ |fÌ‚â‚–| â‰¤ |fÌ‚_0|  + 2M âˆ‘_{k = 1}^âˆ |k|^{-2}  < âˆ.
$$
using the dominant convergence test.

âˆ

This condition can be weakened to Lipschitz continuity but the proof is  beyond the scope
of this module.
Of more practical importance is the other direction: the more times differentiable a function the
faster the coefficients decay, and thence the faster Fourier series converges.
In fact, if a function is smooth and 2Ï€-periodic its Fourier coefficients decay
faster than algebraically: they decay like $O(k^{-Î»})$ for any $Î»$. This will be explored in the
problem sheet.

**Remark (advanced)** Going further, if we let $z = {\rm e}^{{\rm i} Î¸}$ then if $f(z)$ is _analytic_ in a
neighbourhood of the unit circle the Fourier coefficients decay _exponentially fast_. And if $f(z)$ is entire
they decay even faster than exponentially.


## 2. Trapezium rule and discrete Fourier coefficients

Let $Î¸_j = 2Ï€j/n$ for $j = 0,1,â€¦,n$ denote $n+1$ evenly spaced points over $[0,2Ï€]$.
The _Trapezium rule_ over $[0,2Ï€]$ is the approximation:
$$
âˆ«_0^{2Ï€} f(Î¸) {\rm d}Î¸ â‰ˆ {2 Ï€ \over n} \left[{f(0) \over 2} + âˆ‘_{j=1}^{n-1} f(Î¸_j) + {f(2 Ï€) \over 2} \right]
$$
But if $f$ is periodic we have $f(0) = f(2Ï€)$ we get the _periodic Trapezium rule_:
$$
âˆ«_0^{2Ï€} f(Î¸) {\rm d}Î¸ â‰ˆ 2 Ï€\underbrace{{1 \over n} âˆ‘_{j=0}^{n-1} f(Î¸_j)}_{Î£_n[f]}
$$
Define the Trapezium rule approximation to the Fourier coefficients by:
$$
fÌ‚_k^n := Î£_n[f(Î¸) {\rm e}^{-i k Î¸}]  = {1 \over n} âˆ‘_{j=0}^{n-1} f(Î¸_j) {\rm e}^{-i k Î¸_j}
$$

**Lemma (Discrete orthogonality)**
We have:
$$
âˆ‘_{j=0}^{n-1} {\rm e}^{i k Î¸_j} = \begin{cases} n & k = \ldots,-2n,-n,0,n,2n,\ldots  \cr
0 & \hbox{otherwise}
\end{cases}
$$
In other words,
$$
Î£_n[{\rm e}^{i (k-j) Î¸_j}] = \begin{cases} 1 & k-j = \ldots,-2n,-n,0,n,2n,\ldots  \cr
0 & \hbox{otherwise}
\end{cases}.
$$

**Proof**

Consider $Ï‰ := {\rm e}^{{\rm i} Î¸_1} = {\rm e}^{2 Ï€ {\rm i} \over n}$. This is an $n$ th root of unity: $Ï‰^n = 1$.  Note that ${\rm e}^{{\rm i} Î¸_j} ={\rm e}^{2 Ï€ {\rm i} j \over n}= Ï‰^j$.

(Case 1: $k = pn$ for an integer $p$)
We have
$$
âˆ‘_{j=0}^{n-1} {\rm e}^{i k Î¸_j} = âˆ‘_{j=0}^{n-1} Ï‰^{kj} = âˆ‘_{j=0}^{n-1} ({Ï‰^{pn}})^j =   âˆ‘_{j=0}^{n-1} 1 = n
$$
(Case 2 $k â‰  pn$ for an integer $p$)  Recall that
$$
âˆ‘_{j=0}^{n-1} z^j = {z^n-1 \over z-1}.
$$
Then we have
$$
âˆ‘_{j=0}^{n-1} {\rm e}^{i k Î¸_j} = âˆ‘_{j=0}^{n-1} (Ï‰^k)^j = {Ï‰^{kn} -1 \over Ï‰^k -1} = 0.
$$
where we use the fact that $k$ is not a multiple of $n$ to guarantee that $Ï‰^k â‰ Â 1$.

âˆ


**Theorem (discrete Fourier coefficients)**
If $ğŸÌ‚$ is absolutely convergent then
$$
fÌ‚_k^n = â‹¯ + fÌ‚_{k-2n} + fÌ‚_{k-n} + fÌ‚_k + fÌ‚_{k+n} + fÌ‚_{k+2n} + â‹¯
$$

**Proof**
$$
\begin{align*}
fÌ‚_k^n &= Î£_n[f(Î¸) {\rm e}^{-i k Î¸}] = âˆ‘_{j=-âˆ}^âˆ fÌ‚_j Î£_n[f(Î¸) {\rm e}^{i (j-k) Î¸}] \\
&= âˆ‘_{j=-âˆ}^âˆ fÌ‚_j \begin{cases} 1 & j-k = \ldots,-2n,-n,0,n,2n,\ldots  \cr
0 & \hbox{otherwise}
\end{cases}
\end{align*}
$$
âˆ

Note that there is redundancy:

**Corollary (aliasing)**
For all $p âˆˆ â„¤$, $fÌ‚_k^n = fÌ‚_{k+pn}^n$.


In other words if we know $fÌ‚_0^n, â€¦, fÌ‚_{n-1}^n$, we know $fÌ‚_k^n$ for all $k$ via a permutation,
for example if $n = 2m+1$ we have
$$
\begin{bmatrix}
fÌ‚_{-m}^n \\
â‹®\\
fÌ‚_m^n
\end{bmatrix} = \underbrace{\begin{bmatrix} &&& 1 \\ &&& â‹± \\ &&&& 1 \\
    1 \\ & â‹± \\ && 1 \end{bmatrix}}_{P_Ïƒ}
\begin{bmatrix}
fÌ‚_0^n \\
â‹®\\
fÌ‚_{n-1}^n
\end{bmatrix}
$$
where $Ïƒ$ has Cauchy notation (_Careful_: we are using 1-based indexing here):
$$
\begin{pmatrix}
1 & 2 & â‹¯ & m & m+1 & m+2 & â‹¯ & n  \\
m+2 & m+3 & â‹¯ & n & 1 & 2 & â‹¯ & m+1
\end{pmatrix}.
$$



We first discuss the case when all negative coefficients are zero,
noting that the Fourier series is in fact a Taylor series if we let $z = {\rm e}^{{\rm i} Î¸}$:
$$
f(z) = \sum_{k=0}^âˆ fÌ‚_k z^k.
$$
That is, $fÌ‚_0^n, â€¦, fÌ‚_{n-1}^n$ are approximations of the Taylor series coefficients by evaluating
on the boundary.



We can  prove _convergence_ whenever of this
approximation whenever $f$ has absolutely summable coefficients.
We will prove the result here in the special case where the negative
coefficients are zero.


**Theorem (Taylor series converges)**
If $0 = fÌ‚_{-1} = fÌ‚_{-2} = â‹¯$ and $ğŸÌ‚$ is absolutely convergent then
$$
f_n(Î¸) = âˆ‘_{k=0}^{n-1} fÌ‚_k^n {\rm e}^{{\rm i} k Î¸}
$$
converges uniformly to $f(Î¸)$.

**Proof**

$$
\begin{align*}
|f(Î¸) - f_n(Î¸)| = |âˆ‘_{k=0}^{n-1} (fÌ‚_k - fÌ‚_k^n) {\rm e}^{{\rm i} k Î¸} + âˆ‘_{k=n}^âˆ fÌ‚_k {\rm e}^{{\rm i} k Î¸}|
= |âˆ‘_{k=n}^âˆ fÌ‚_k ({\rm e}^{{\rm i} k Î¸} - {\rm e}^{{\rm i} {\rm mod}(k,n) Î¸})|
â‰¤ 2 âˆ‘_{k=n}^âˆ |fÌ‚_k|
\end{align*}
$$
which goes to zero as $n â†’ âˆ$.
âˆ

For the general case we need to choose a range of coefficients that includes roughly an equal number of
negative and positive coefficients (preferring negative over positive in a tie as a convention):
$$
f_n(Î¸) = âˆ‘_{k=-âŒˆn/2âŒ‰}^{âŒŠn/2âŒ‹} fÌ‚â‚– {\rm e}^{{\rm i} k Î¸}
$$
In the problem sheet we will prove this converges provided the coefficients are absolutely convergent.







## 3. Discrete Fourier transform and interpolation

We note that the map from values to coefficients can be defined as a matrix-vector product using the DFT:


**Definition (DFT)**
The _Discrete Fourier Transform (DFT)_ is defined as:
$$
\begin{align*}
Q_n &:= {1 \over âˆšn} \begin{bmatrix} 1 & 1 & 1&  â‹¯ & 1 \\
                                    1 & {\rm e}^{-{\rm i} Î¸_1} & {\rm e}^{-{\rm i} Î¸_2} & â‹¯ & {\rm e}^{-{\rm i} Î¸_{n-1}} \\
                                    1 & {\rm e}^{-{\rm i} 2 Î¸_1} & {\rm e}^{-{\rm i} 2 Î¸_2} & â‹¯ & {\rm e}^{-{\rm i} 2Î¸_{n-1}} \\
                                    â‹® & â‹® & â‹® & â‹± & â‹® \\
                                    1 & {\rm e}^{-{\rm i} (n-1) Î¸_1} & {\rm e}^{-{\rm i} (n-1) Î¸_2} & â‹¯ & {\rm e}^{-{\rm i} (n-1) Î¸_{n-1}}
\end{bmatrix} \\
&= {1 \over âˆšn} \begin{bmatrix} 1 & 1 & 1&  â‹¯ & 1 \\
                                    1 & Ï‰^{-1} & Ï‰^{-2} & â‹¯ & Ï‰^{-(n-1)}\\
                                    1 & Ï‰^{-2} & Ï‰^{-4} & â‹¯ & Ï‰^{-2(n-1)}\\
                                    â‹® & â‹® & â‹® & â‹± & â‹® \\
                                    1 & Ï‰^{-(n-1)} & Ï‰^{-2(n-1)} & â‹¯ & Ï‰^{-(n-1)^2}
\end{bmatrix}
\end{align*}
$$
for the $n$-th root of unity $Ï‰ = {\rm e}^{{\rm i} Ï€/n}$. Note that
$$
\begin{align*}
Q_n^â‹† &= {1 \over âˆšn} \begin{bmatrix}
1 & 1 & 1&  â‹¯ & 1 \\
1 & {\rm e}^{{\rm i} Î¸_1} & {\rm e}^{{\rm i} 2 Î¸_1} & â‹¯ & {\rm e}^{{\rm i} (n-1) Î¸_1} \\
1 &  {\rm e}^{{\rm i} Î¸_2}  & {\rm e}^{{\rm i} 2 Î¸_2} & â‹¯ & {\rm e}^{{\rm i} (n-1)Î¸_2} \\
â‹® & â‹® & â‹® & â‹± & â‹® \\
1 & {\rm e}^{{\rm i} Î¸_{n-1}} & {\rm e}^{{\rm i} 2 Î¸_{n-1}} & â‹¯ & {\rm e}^{{\rm i} (n-1) Î¸_{n-1}}
\end{bmatrix} \\
&= {1 \over âˆšn} \begin{bmatrix}
1 & 1 & 1&  â‹¯ & 1 \\
1 & Ï‰^{1} & Ï‰^{2} & â‹¯ & Ï‰^{(n-1)}\\
1 & Ï‰^{2} & Ï‰^{4} & â‹¯ & Ï‰^{2(n-1)}\\
â‹® & â‹® & â‹® & â‹± & â‹® \\
1 & Ï‰^{(n-1)} & Ï‰^{2(n-1)} & â‹¯ & Ï‰^{(n-1)^2}
\end{bmatrix}
\end{align*}
$$

That is, we have
$$
\underbrace{\begin{bmatrix} f_0^n \\ â‹® \\ f_{n-1}^n \end{bmatrix}}_{ğŸÌ‚â¿} = {1 \over âˆšn} Q_n \underbrace{\begin{bmatrix} f(Î¸â‚€) \\ â‹® \\ f(Î¸â‚™) \end{bmatrix}}_{ğŸâ¿}
$$

The choice of normalisation constant is motivated by the following:

**Proposition (DFT is Unitary)** $Q_n$ is unitary: $Q_n^â‹† Q_n = Q_n Q_n^â‹† = I$.

**Proof**
$$
Q_n Q_n^â‹†  = \begin{bmatrix} Î£_n[1] & Î£_n[{\rm e}^{{\rm i} Î¸}] & â‹¯ & Î£_n[{\rm e}^{{\rm i} (n-1) Î¸}] \\
                            Î£_n[{\rm e}^{-{\rm i} Î¸}] & Î£_n[1] & â‹¯ & Î£_n[{\rm e}^{{\rm i} (n-2) Î¸}] \\
                            â‹® & â‹® & â‹± & â‹® \\
                            Î£_n[{\rm e}^{-{\rm i}(n-1) Î¸}] & Î£_n[{\rm e}^{-{\rm i}(n-2) Î¸}] & â‹¯ & Î£_n[1]
                            \end{bmatrix} = I
$$
âˆ

In other words, $Q_n$ is easily inverted and we also have a map from discrete Fourier coefficients back to values:
$$
\sqrt{n} Q_n^â‹† ğŸÌ‚â¿ = ğŸâ¿
$$

**Corollary (Interpolation)**
$f_n(Î¸)$ interpolates $f$ at $Î¸_j$:
$$
f_n(Î¸_j) = f(Î¸_j)
$$

**Proof**
We have
$$
f_n(Î¸_j) = âˆ‘_{k=0}^{n-1} fÌ‚_k^n {\rm e}^{{\rm i} k Î¸_j} = âˆšn ğ_j^âŠ¤ Q_n^â‹† ğŸÌ‚â¿ = ğ_j^âŠ¤ Q_n^â‹† Q_n ğŸâ¿ = f(Î¸_j).
$$

âˆ


We will leave extending this result to the problem sheet. Note that regardless of choice of coefficients
we interpolate, though some interpolations are better than others:

```julia
using Plots, LinearAlgebra


# evaluates f_n at a point
function finitefourier(ğŸÌ‚â‚™, Î¸)
    m = n Ã· 2 # use coefficients between -m:m
    ret = 0.0 + 0.0im # coefficients are complex so we need complex arithmetic
    for k = 0:m
        ret += ğŸÌ‚â‚™[k+1] * exp(im*k*Î¸)
    end
    for k = -m:-1
        ret += ğŸÌ‚â‚™[end+k+1] * exp(im*k*Î¸)
    end
    ret
end

function finitetaylor(ğŸÌ‚â‚™, Î¸)
    ret = 0.0 + 0.0im # coefficients are complex so we need complex arithmetic
    for k = 0:n-1
        ret += ğŸÌ‚â‚™[k+1] * exp(im*k*Î¸)
    end
    ret
end


f = Î¸ -> exp(cos(Î¸))
n = 7
Î¸ = range(0,2Ï€; length=n+1)[1:end-1] # Î¸_0, â€¦,Î¸_{n-1}, dropping Î¸_n == 2Ï€
Qâ‚™ = 1/sqrt(n) * [exp(-im*(k-1)*Î¸[j]) for k = 1:n, j=1:n]
ğŸÌ‚â‚™ = 1/sqrt(n) * Qâ‚™ * f.(Î¸)


fâ‚™ = Î¸ -> finitefourier(ğŸÌ‚â‚™, Î¸)
tâ‚™ = Î¸ -> finitetaylor(ğŸÌ‚â‚™, Î¸)

g = range(0, 2Ï€; length=1000) # plotting grid
plot(g, f.(g); label="function", legend=:bottomright)
plot!(g, real.(fâ‚™.(g)); label="Fourier")
plot!(g, real.(tâ‚™.(g)); label="Taylor")
scatter!(Î¸, f.(Î¸); label="samples")
```

We now demonstrate the relationship of Taylor and Fourier coefficients
and their discrete approximations for some examples:

**Example** Consider the function
$$
f(Î¸) = {2 \over 2 - {\rm e}^{{\rm i} Î¸}}
$$
Under the change of variables $z = {\rm e}^{{\rm i} Î¸}$ we know for
$z$ on the unit circle this becomes (using the geometric series with $z/2$)
$$
{2 \over 2-z} = âˆ‘_{k=0}^âˆ {z^k \over 2^k}
$$
i.e., $fÌ‚_k = 1/2^k$ which is absolutely summable:
$$
âˆ‘_{k=0}^âˆ |fÌ‚_k| = f(0) = 2.
$$
If we use an $n$ point discretisation we get (using the geoemtric series with $2^{-n}$)
$$
fÌ‚_k^n = fÌ‚_k + fÌ‚_{k+n} + fÌ‚_{k+n} + â‹¯ = âˆ‘_{p=0}^âˆ {1 \over 2^{k+pn}} = {2^{n-k} \over 2^n - 1}
$$
We can verify this numerically:
```julia
f = Î¸ -> 2/(2 - exp(im*Î¸))
n = 7
Î¸ = range(0,2Ï€; length=n+1)[1:end-1] # Î¸_0, â€¦,Î¸_{n-1}, dropping Î¸_n == 2Ï€
Qâ‚™ = 1/sqrt(n) * [exp(-im*(k-1)*Î¸[j]) for k = 1:n, j=1:n]

Qâ‚™/sqrt(n)*f.(Î¸) â‰ˆ 2 .^ (n .- (0:n-1)) / (2^n-1)
```

## 4. Fast Fourier Transform

Applying $Qâ‚™$ or its adjoint $Q_n^â‹†$ to a vector naively takes $O(n^2)$ operations.
Both can be reduced to $O(n \log n)$ using the celebrated _Fast Fourier Transform_ (FFT),
which is one of the [Top 10 Algorithms of the 20th Century](https://pi.math.cornell.edu/~web6140/)
(You won't believe number 7!).

The key observation is that hidden in $Q_{2n}$ are 2 copies of
$Q_n$. We will work with multiple $n$ we denote the $n$-th root as $Ï‰_n = \exp(2Ï€/n)$.
Note that we can relate a vector of powers of $Ï‰_{2n}$ to two copies of vectors of powers of $Ï‰_n$:
$$
\underbrace{\begin{bmatrix} 1 \\ Ï‰_{2n} \\ â‹® \\ Ï‰_{2n}^{2n-1} \end{bmatrix}}_{\vec{Ï‰}_{2n}} =
P_Ïƒ^âŠ¤ \begin{bmatrix} I_n \\ Ï‰_{2n} I_n \end{bmatrix} \underbrace{\begin{bmatrix} 1 \\ Ï‰_n \\ â‹® \\ Ï‰_n^{n-1} \end{bmatrix}}_{\vec{Ï‰}_n}
$$
where $Ïƒ$ has the Cauchy notation
$$
\begin{pmatrix}
1 & 2 & 3 & â‹¯ & n & n+1 & â‹¯ & 2n \\
1 & 3 & 5 & â‹¯ & 2n-1 & 2 & â‹¯ & 2n
\end{pmatrix}
$$
That is, $P_Ïƒ$ is the following matrix which takes the even entries
and places them in the first $n$ entries and the odd entries in the
last $n$ entries:
```julia
n = 4
Ïƒ = [1:2:2n-1; 2:2:2n]
P_Ïƒ = I(2n)[Ïƒ,:]
```
and so $P_Ïƒ^âŠ¤$ reverses the process.
Thus we have
$$
\begin{align*}
Q_{2n}^â‹† &= {1 \over \sqrt{2n}} \begin{bmatrix} ğŸ_{2n} | \vec{Ï‰}_{2n} | \vec{Ï‰}_{2n}^2 | â‹¯ | \vec{Ï‰}_{2n}^{2n-1} \end{bmatrix}
= {1 \over \sqrt{2n}} P_Ïƒ^âŠ¤ \begin{bmatrix} ğŸ_{n} &   \vec{Ï‰}_n        & \vec{Ï‰}_n^2          & â‹¯ & \vec{Ï‰}_n^{n-1}          & \vec{Ï‰}_n^n  & â‹¯ & \vec{Ï‰}_n^{2n-1}  \\
                        ğŸ_{n} & Ï‰_{2n} \vec{Ï‰}_n & Ï‰_{2n}^2 \vec{Ï‰}_n^2 & â‹¯ & Ï‰_{2n}^{n-1} \vec{Ï‰}_n^{n-1} & Ï‰_{2n}^n \vec{Ï‰}_n^n  & â‹¯ & Ï‰_{2n}^{2n-1} \vec{Ï‰}_n^{2n-1}
\end{bmatrix} \\
&= {1 \over \sqrt{2}} P_Ïƒ^âŠ¤ \begin{bmatrix} Q_n^â‹† & Q_n^â‹† \\
                                     Q_n^â‹† D_n & -Q_n^â‹† D_n
                                     \end{bmatrix} =
                                     {1 \over \sqrt{2}}P_Ïƒ^âŠ¤ \begin{bmatrix} Q_n^â‹† \\ &Q_n^â‹† \end{bmatrix} \begin{bmatrix} I_n & I_n \\ D_n & -D_n \end{bmatrix}
\end{align*}
$$
In other words, we reduced the DFT to two DFTs applied to vectors of half the dimension.

We can see this formula in code:
```julia
function fftmatrix(n)
    Î¸ = range(0,2Ï€; length=n+1)[1:end-1] # Î¸_0, â€¦,Î¸_{n-1}, dropping Î¸_n == 2Ï€
    [exp(-im*(k-1)*Î¸[j]) for k = 1:n, j=1:n]/sqrt(n)
end

Qâ‚‚â‚™ = fftmatrix(2n)
Qâ‚™ = fftmatrix(n)
Dâ‚™ = Diagonal([exp(im*k*Ï€/n) for k=0:n-1])
(P_Ïƒ'*[Qâ‚™' Qâ‚™'; Qâ‚™'*Dâ‚™ -Qâ‚™'*Dâ‚™])[1:n,1:n] â‰ˆ sqrt(2)Qâ‚‚â‚™'[1:n,1:n]
```


Now assume $n = 2^q$ so that $\log_2 n = q$. To see that we get $O(n \log n) = O(n q)$ operations we need to count the operations.
Assume that applying $F_n$ takes $â‰¤3n q$ additions and multiplications. The first $n$ rows takes $n$ additions. The last $n$ has $n$ multiplications and $n$ additions.
Thus we have $6nq + 3n â‰¤ 6n(q+1) = 3 (2n) \log_2(2n)$ additions/multiplications, showing by induction that we have $O(n \log n)$ operations.



**Remark** The FFTW.jl package wraps the FFTW (Fastest Fourier Transform in the West) library,
which is a highly optimised implementation
of the FFT that also works well even when $n$ is not a power of 2.
(As an aside, the creator of FFTW [Steven Johnson](https://math.mit.edu/~stevenj/) is now a
Julia contributor and user.)
 Here we approximate $\exp(\cos(Î¸-0.1))$ using
31 nodes:
```julia
using FFTW
f = Î¸ -> exp(cos(Î¸-0.1))
n = 31
m = nÃ·2
# evenly spaced points from 0:2Ï€, dropping last node
Î¸ = range(0, 2Ï€; length=n+1)[1:end-1]

# fft returns discrete Fourier coefficients n*[fÌ‚â¿_0, â€¦, fÌ‚â¿_(n-1)]
fc = fft(f.(Î¸))/n

# We reorder using [fÌ‚â¿_(-m), â€¦, fÌ‚â¿_(-1)] == [fÌ‚â¿_(n-m), â€¦, fÌ‚â¿_(n-1)]
#  == [fÌ‚â¿_(m+1), â€¦, fÌ‚â¿_(n-1)]
fÌ‚ = [fc[m+2:end]; fc[1:m+1]]

# equivalent to fÌ‚â¿_(-m)*exp(-im*m*Î¸) + â€¦Â + fÌ‚â¿_(m)*exp(im*m*Î¸)
fâ‚™ = Î¸ -> transpose([exp(im*k*Î¸) for k=-m:m]) * fÌ‚

# plotting grid
g = range(0, 2Ï€; length=1000)
plot(abs.(fâ‚™.(g) - f.(g)))
```
Thus we have successfully approximate the function to roughly machine precision.
The magic of the FFT is because it's $O(n \log n)$ we can scale it to very high orders.
Here we plot the Fourier coefficients for a function that requires around 100k
coefficients to resolve:
```julia
f = Î¸ -> exp(sin(Î¸))/(1+1e6cos(Î¸)^2)
n = 100_001
m = nÃ·2
# evenly spaced points from 0:2Ï€, dropping last node
Î¸ = range(0, 2Ï€; length=n+1)[1:end-1]

# fft returns discrete Fourier coefficients n*[fÌ‚â¿_0, â€¦, fÌ‚â¿_(n-1)]
fc = fft(f.(Î¸))/n


# We reorder using [fÌ‚â¿_(-m), â€¦, fÌ‚â¿_(-1)] == [fÌ‚â¿_(n-m), â€¦, fÌ‚â¿_(n-1)]
#  == [fÌ‚â¿_(m+1), â€¦, fÌ‚â¿_(n-1)]
fÌ‚ = [fc[m+2:end]; fc[1:m+1]]

plot(abs.(fc); yscale=:log10, legend=:bottomright, label="default")
plot!(abs.(fÌ‚); yscale=:log10, label="reordered")
```

We can use the FFT to compute some mathematical objects efficiently.
Here is a simple example.

**Example** Define the following infinite sum (which has no name apparently,
according to Mathematica):
$$
S_n(k) := âˆ‘_{p=0}^âˆ {1 \over (k+pn)!}
$$
We can use the FFT to compute $S_n(0), â€¦, S_n(n-1)$ in $O(n \log n)$ operations.
Consider
$$
f(Î¸) = \exp({\rm e}^{{\rm i} Î¸}) = âˆ‘_{k=0}^âˆ {{\rm e}^{{\rm i} Î¸} \over k!}
$$
where we know the Fourier coefficients from the Taylor series of ${\rm e}^z$. 
The discrete Fourier coefficients satisfy for $0 â‰¤Â k â‰¤Â n-1$:
$$
fÌ‚_k^n = fÌ‚_k + fÌ‚_{k+n} + fÌ‚_{k+2n} + â‹¯ = S_n(k)
$$
Thus we have
$$
\begin{bmatrix}
S_n(0) \\ 
â‹® \\
S_n(n-1)
\end{bmatrix} = {1 \over \sqrt{n}} Q_n \begin{bmatrix} 1 \\
                                \exp({\rm e}^{2{\rm i} Ï€/n}) \\
                                â‹® \\
                                \exp({\rm e}^{2{\rm i} (n-1) Ï€/n}) \end{bmatrix}
$$


